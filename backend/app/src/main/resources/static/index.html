<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“Š Google Sheet to JSON</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f7f7f7; }
    button, select { font-size: 1rem; padding: 0.5rem; margin: 0.5rem 0.5rem 0.5rem 0; }
    pre { background: white; padding: 1rem; border: 1px solid #ccc; max-height: 500px; overflow: auto; }
    .loading { color: gray; font-style: italic; }
  </style>
</head>
<body>

  <h1>ğŸ“‚ ë°ì´í„° ì‹œíŠ¸ í™•ì¸</h1>
  <div id="status" class="loading">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <select id="sheetSelect" disabled></select>

  <br>
  <button id="saveBtn" disabled>ğŸ’¾ ë°ì´í„° ì €ì¥</button>

  <h2>ğŸ§¾ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h2>
  <pre id="resultArea">[ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° ì˜ì—­]</pre>

  <script>
    let fullData = {};

    async function initSheets() {
      try {
        const res = await fetch("/sheets"); // ì‹œíŠ¸ ì´ë¦„ ìš”ì²­
        const names = await res.json();

        const select = document.getElementById("sheetSelect");
        const status = document.getElementById("status");

        names.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          select.appendChild(opt);
        });

        status.textContent = "âœ… ì‹œíŠ¸ ë¡œë”© ì™„ë£Œ";
        select.disabled = false;
        document.getElementById("saveBtn").disabled = false;

      } catch (err) {
        document.getElementById("status").textContent = "âŒ ë¡œë”© ì‹¤íŒ¨";
        console.error("ì‹œíŠ¸ ë¡œë”© ì˜¤ë¥˜:", err);
      }
    }

    document.getElementById("saveBtn").addEventListener("click", async () => {
      const sheet = document.getElementById("sheetSelect").value;
      const resultArea = document.getElementById("resultArea");

      resultArea.textContent = "ğŸ“¡ ì €ì¥ ì¤‘...";
      try {
        const res = await fetch(`/sheets/${sheet}`);
        const data = await res.json();

        const preview = data.slice(0, 10); // ìµœëŒ€ 10ê°œ
        resultArea.textContent =
          `âœ… ì €ì¥ ì™„ë£Œ (${data.length}ê°œ í•­ëª©)\n\n` +
          JSON.stringify(preview, null, 2);

      } catch (err) {
        resultArea.textContent = "âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ";
        console.error("ì €ì¥ ì˜¤ë¥˜:", err);
      }
    });

    initSheets(); // ìµœì´ˆ ì‹¤í–‰
  </script>

</body>
</html>
